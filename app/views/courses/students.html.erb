<% if flash[:alert] %>
    <div class="alert alert-error">
      <%= flash[:alert] %>
    </div>
<% end %>
<h1>Class Enrollment</h1>

<% if can? :manage, UserCourse %>
    <% tas = (@lecturer_courses + @ta_courses).map {|tac| [tac.user.name, tac.id] }.unshift(["Unassigned", -1]) %>
    <table class="table">
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Tutor</th>
        <th></th>
      </tr>
      <% @student_courses.each_with_index do |student_course| %>
          <% student = student_course.user %>
          <%= form_for [@course,student_course],
                       html: { method: :put, class: "form-horizontal" }  do |f| %>
              <tr>
                <td>
                  <input type="text" name="name" value="<%= student.name %>" required>
                </td>
                <td>
                  <input type="email" name="email" value="<%= student.email %>" required>
                </td>
                <td>
                  <%tutor = student_course.get_my_tutors.first %>
                  <% if tutor %>
                      <%= select "tutor","", tas, {:selected => "#{tutor.id}" }%>
                  <% else %>
                      <%= select "tutor","", tas, {:selected => "#{-1}" }%>
                  <% end %>


                </td>
                <td>
                  <input type="hidden" name="redirect_back_url" value="<%= course_students_url(@course)%>">
                  <button type="submit" class="btn">
                    <i class="icon-ok"></i>
                  </button>
                  <%= link_to course_user_course_path(@course, student_course),
                              method: :delete,
                              data: { confirm: t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                              class: 'btn btn-danger' do %>
                      <i class="icon-trash"></i>
                  <% end %>
                </td>
              </tr>
          <% end %>
      <% end %>
    </table>
    <%= paginate @student_courses %>
<% else %>

    <h3>Lecturers:</h3>
    <br/>
    <ul>
      <% @lecturer_courses.each do |lecturer_course| %>
          <li>
            <%= render partial: "layouts/user_thumb_profile", locals: { user_course: lecturer_course } %>
          </li>
      <% end %>
    </ul>
    <% if @ta_courses.size > 0 %>
        <h3>Tutors:</h3>
        <br/>
        <table class="table table-bordered">
          <tbody>
          <% @ta_courses.each_with_index do |tut_course, i| %>
              <% if i % 2 == 0 %>
                  <tr>
              <% end %>
              <td width="50%">
                <%= render partial: "layouts/user_thumb_profile", locals: { user_course: tut_course } %>
              </td>
              <% if i % 2 == 1 %>
                  </tr>
              <% end %>
          <% end %>
          <% if @ta_courses.size % 2 == 1 %>
              <td></td></tr>
          <% end %>
          </tbody>
        </table>
    <% end %>
    <h3>Students:</h3>
    <br/>
    <table class="table table-bordered">
      <% @student_courses.each_with_index do |student_course, i| %>
          <% if i % 2 == 0 %>
              <tr>
          <% end %>
          <td width="50%">
            <%= render partial: "layouts/user_thumb_profile", locals: { user_course: student_course } %>
          </td>
          <% if i % 2 == 1 %>
              </tr>
          <% end %>
      <% end %>
      <% if @student_courses.size % 2 == 1 %>
          <td></td></tr>
      <% end %>
    </table>
    <%= paginate @student_courses %>

<% end %>