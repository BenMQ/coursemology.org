<table class="table assignments materials-list-table">
  <thead>
    <tr>
      <th>Name</th>
      <th style="width: 25%">Modified</th>
      <th style="width: 20%">&nbsp;</th>
    </tr>
  </thead>

  <tbody class="table-hover">
    <% (@subfolders.sort {|left, right|
          if (left.is_virtual? != right.is_virtual?)
            if left.is_virtual? then -1
            else 1
            end
          else
            left.name.downcase <=> right.name.downcase
          end
        }).each do |subfolder| %>
      <tr>
        <td>
          <% path = if subfolder.is_virtual? then
              course_material_virtual_folder_path(@course, subfolder.id)
            else
              course_material_folder_path(@course, subfolder)
            end %>
          <%= link_to path do %>
          <%= render partial:"subfolder_title", :locals => { :subfolder => subfolder } %>
          <% end %>
          
          <% if subfolder.description %>
          <p><%= truncate_html subfolder.description, :length => 100 %></p>
          <% end %>
        </td>

        <td>
          <%= datetime_format(subfolder.updated_at) %>
        </td>

        <td>
          <% if (can? :manage, subfolder) %>
          <% if not subfolder.is_virtual? %>
            <%= link_to course_edit_material_folder_path(@course, subfolder), class: 'btn' do %>
              <i class="icon-edit"></i>
            <% end %>
            <%= link_to course_material_folder_path(@course, subfolder),
              method: :delete,
              data: { confirm: t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
              class: 'btn btn-danger' do %>
                <i class="icon-trash"></i>
            <% end %>
          <% else %>
          <%= render partial: "disabled_controls" %>
          <% end %>
          <% end %>
        </td>

      </tr>
    <% end %>

    <% @files.sort_by{|file| file.filename.downcase}.each do |material| %>
      <tr>
        <td>
          <% link = if material.is_virtual? then
              material.url
            else
              course_material_path(@course, material)
            end %>
          <%= link_to link do %>
            <%= render partial: "layouts/material_title", locals: {material: material} %>
          <% end %>
          <% if material.description %>
            <p><%= material.description.html_safe %></p>
          <% end %>
        </td>
        
        <td>
          <%= get_pretty_file_size(material.filesize) %>
        </td>

        <td>
          <%= datetime_format(material.updated_at) %> by <%= material.file.creator.name %>
        </td>

        <td>
          <% if (can? :manage, material) %>
          <% if material.is_virtual? %>
            <%= render partial: "disabled_controls" %>
          <% else %>
            <%= link_to edit_course_material_path(@course, material), class: 'btn' do %>
              <i class="icon-edit"></i>
            <% end %>
            <%= link_to course_material_path(@course, material),
              method: :delete,
              data: { confirm: t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
              class: 'btn btn-danger' do %>
                <i class="icon-trash"></i>
            <% end %>
          <% end %>
          <% end %>
        </td>

      </tr>
    <% end %>
  </tbody>
</table>
