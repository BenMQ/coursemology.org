<div class="materials-folder-controls">
  <span>
    <% if (can? :upload, @folder) %>
      <% if @folder.is_virtual? %>
        <span class="workbin-disabled-controls" title="This folder is reserved for Mission/Training files.">
          <a class='btn disabled' title="Upload Files">
            <h4 class="icon-upload"></h4>
          </a>
          <a class="btn disabled" title="Create Folder">
            <h4 class="icon-folder-close"></h4>
          </a>
        </span>
      <% else %>
      <% if (can? :upload, @folder) %>
        <a href="<%= upload_course_material_folder_path(@course, @folder) %>" class='btn hover-tooltip' 
           title="Upload Files">
          <h4 class="icon-upload"></h4>
        </a>
      <% end %>
      <% if (can? :manage, @folder) %>
        <a href="#create-subfolder-modal" class="btn hover-tooltip" title="Create Folder">
          <h4 class="icon-folder-close"></h4>
        </a>
      <% end %>
      <% end %>
    <% end %>
    &nbsp;
  </span>
  
  <span class="pull-right btn-group">
    <% if (can? :manage, @folder) %>
      <% if @folder.is_virtual? %>
      <a class="btn disabled workbin-disabled-controls" title="This folder can't be edited.">Edit</a>
      <% else %>
      <%= link_to "Edit", "#edit-subfolder-modal", "data-toggle" => "modal", :class => 'btn' %>
      <% end %>
    <% end %>
    <%= link_to "Download .zip", (@folder.is_virtual? ?
        course_material_virtual_folder_path(@course, @folder.id, :format => 'zip') :
        course_material_folder_path(@course, @folder, :format => 'zip')),
        :class => 'btn', :id => 'workbin-download-zip-button' %>
    
    <% if not(@folder.is_virtual?) %>
    <%= link_to "Mark as Seen", course_material_folder_mark_read_path(@course, @folder), :class => 'btn' %>
    <% end %>
  </span>
</div>

<% if (can? :manage, @folder) && not(@folder.is_virtual?) %>
<div id="create-subfolder-modal" class="modal hide fade">
  <div class="modal-header">
    Create Subfolder
  </div>
  <%= render partial: "subfolder_form", locals: { modal: true, folder_to_change: MaterialFolder.new, subfolder_method: :post } %>
</div>

<div id="edit-subfolder-modal" class="modal hide fade">
  <div class="modal-header">
    Edit Folder
  </div>
  <%= render partial: "subfolder_form", locals: { modal: false, folder_to_change: @folder, subfolder_method: :put } %>
</div>
<% end %>
